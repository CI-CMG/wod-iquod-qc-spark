package edu.colorado.cires.wod.iquodqc.common.refdata.cotede;

import static org.junit.jupiter.api.Assertions.assertArrayEquals;

import java.time.LocalDateTime;
import java.time.ZoneId;
import java.util.Properties;
import org.apache.commons.math3.util.FastMath;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;

public class CoTeDeStatsNormbiasTest {
  
  private static final double[] EXPECTED_NORMBIAS = {1.43171821e-01,  1.53652415e-01,  1.56347609e-01,  1.50993936e-01,        1.45586091e-01,  1.44831668e-01,  1.44546608e-01,  1.43800150e-01,        1.45995908e-01,  1.47873969e-01,  1.49580079e-01,  1.52837712e-01,        1.56411342e-01,  1.60612064e-01,  1.65755132e-01,  1.72733091e-01,        1.80022318e-01,  1.84826179e-01,  1.92266506e-01,  1.99239115e-01,        2.10823454e-01,  2.19594207e-01,  2.25405346e-01,  2.30429213e-01,        2.39134999e-01,  2.54120095e-01,  2.60271613e-01,  2.72466795e-01,        2.75311613e-01,  2.70128666e-01,  2.77999137e-01,  2.95786955e-01,        3.09266865e-01,  3.22635151e-01,  3.36899070e-01,  3.60365306e-01,        3.82076327e-01,  3.81468179e-01,  2.95722813e-01,  9.15733452e-02,       -6.90466119e-02, -4.09713207e-01, -6.79056525e-01, -1.12586467e+00,       -1.17982205e+00, -1.09150314e+00, -1.00393230e+00, -9.51348758e-01,       -9.67841088e-01, -1.06829487e+00, -1.11488826e+00, -1.30248189e+00,       -1.32803056e+00, -1.27867693e+00, -1.21716257e+00, -1.13698706e+00,       -1.09868633e+00, -9.93928399e-01, -9.08728872e-01, -8.96265123e-01,       -9.66371657e-01, -1.10559782e+00, -1.23611348e+00, -1.22527878e+00,       -1.16811817e+00, -1.17977301e+00, -1.17414610e+00, -1.26089192e+00,       -1.58881074e+00, -1.90350593e+00, -1.90740100e+00, -1.83070128e+00,       -1.75543073e+00, -1.68223985e+00, -1.65680527e+00, -1.64506072e+00,       -1.59058538e+00, -1.56155572e+00, -1.54912834e+00, -1.50415044e+00,       -1.47325638e+00, -1.41080762e+00, -1.35682770e+00, -1.32065929e+00,       -1.31939263e+00, -1.33515325e+00, -1.33118741e+00, -1.30775437e+00,       -1.27430760e+00, -1.27233267e+00, -1.28711542e+00, -1.33707018e+00,       -1.38663949e+00, -1.42712066e+00, -1.47088280e+00, -1.49413090e+00,       -1.48905332e+00, -1.46305746e+00, -1.45465738e+00, -1.43316839e+00,       -1.46761195e+00, -1.46186241e+00, -1.44361246e+00, -1.43212620e+00,       -1.40332245e+00, -1.37625256e+00, -1.34939415e+00, -1.32525369e+00,       -1.30334247e+00, -1.27803790e+00, -1.25701454e+00, -1.23420031e+00,       -1.23390336e+00, -1.22348134e+00, -1.20065690e+00, -1.16765076e+00,       -1.13235744e+00, -1.10015748e+00, -1.06841393e+00, -1.05233844e+00,       -1.06129855e+00, -1.10247256e+00, -1.13561035e+00, -1.11557947e+00,       -1.08546891e+00, -1.07259029e+00, -1.07645722e+00, -1.08354170e+00,       -1.06479954e+00, -1.04830446e+00, -1.02984396e+00, -1.00851610e+00,       -9.87104147e-01, -9.66807167e-01, -9.44342278e-01, -9.22139470e-01,       -8.98469310e-01, -8.78650793e-01, -8.56309475e-01, -8.33327676e-01,       -8.08514361e-01, -8.09435200e-01, -8.18345520e-01, -8.07378365e-01,       -7.90236147e-01, -7.73057223e-01, -7.52139594e-01, -7.23905006e-01,       -7.01799582e-01, -6.82499507e-01, -6.67679071e-01, -6.51076094e-01,       -6.35381119e-01, -6.35875952e-01, -6.27971980e-01, -6.21942689e-01,       -6.00669126e-01, -5.78001146e-01, -5.57506374e-01, -5.41392680e-01,       -5.29477156e-01, -5.08124981e-01, -4.84024263e-01, -4.58901220e-01,       -4.31521491e-01, -4.10729255e-01, -4.03170874e-01, -3.85820060e-01,       -3.58829259e-01, -3.35445143e-01, -3.10397663e-01, -2.77721351e-01,       -2.39951559e-01, -1.97618070e-01, -1.53164070e-01, -1.28508029e-01,       -1.09749947e-01, -9.42466703e-02, -7.21426386e-02, -4.08173907e-02,       -1.18258017e-02,  1.03140061e-02,  3.17088688e-02,  4.78150309e-02,        5.10440196e-02,  5.98749574e-02,  6.97925661e-02,  9.13169127e-02,        1.21115257e-01,  1.50220282e-01,  1.75827218e-01,  1.86512009e-01,        1.64953106e-01,  1.52195642e-01,  1.29301185e-01,  1.58634321e-01,        1.92230293e-01,  2.18809434e-01,  2.31882923e-01,  2.35891646e-01,        2.31374301e-01,  2.16667532e-01,  2.13717380e-01,  2.33725239e-01,        2.46531712e-01,  2.41726459e-01,  2.23953294e-01,  2.32072593e-01,        2.57815117e-01,  2.78485964e-01,  2.92295015e-01,  3.07508324e-01,        3.25219503e-01,  3.40668254e-01,  3.64636506e-01,  3.89089156e-01,        4.17731725e-01,  4.45914025e-01,  4.68136748e-01,  4.84506798e-01,        5.01895394e-01,  5.23897827e-01,  5.47075618e-01,  5.71852764e-01,        5.91571645e-01,  6.09214417e-01,  6.32320333e-01,  6.55058529e-01,        6.79099242e-01,  7.02914356e-01,  7.23148696e-01,  7.28460724e-01,        7.36025836e-01,  7.44168019e-01,  7.45312153e-01,  7.48002555e-01,        7.50700240e-01,  7.42000774e-01,  7.46810427e-01,  7.67574713e-01,        7.89938153e-01,  8.13199167e-01,  8.27167510e-01,  8.32382164e-01,        8.24414921e-01,  8.29922085e-01,  8.35724413e-01,  8.47945901e-01,        8.63756814e-01,  8.84308778e-01,  9.06475347e-01,  9.26451807e-01,        9.45946538e-01,  9.66396129e-01,  9.87374162e-01,  1.00975244e+00,        1.02165115e+00,  1.01543902e+00,  1.00395178e+00,  9.96208116e-01,        9.87842355e-01,  9.69313321e-01,  9.63490854e-01,  9.75330534e-01,        9.99196300e-01,  1.02480592e+00,  1.05335971e+00,  1.08368703e+00,        1.11446061e+00,  1.14388775e+00,  1.17045932e+00,  1.18844348e+00,        1.19069687e+00,  1.19658570e+00,  1.21628019e+00,  1.23320112e+00,        1.24226068e+00,  1.25846083e+00,  1.27255459e+00,  1.28271864e+00,        1.29532471e+00,  1.31372318e+00,  1.32134460e+00,  1.30294449e+00,        1.27066347e+00,  1.28269084e+00,  1.29061535e+00,  1.30557006e+00,        1.32344228e+00,  1.33354641e+00,  1.35344465e+00,  1.37550866e+00,        1.39943751e+00,  1.42293475e+00,  1.44676846e+00,  1.46878994e+00,        1.48915049e+00,  1.51045864e+00,  1.50967093e+00,  1.41050979e+00,        1.36058624e+00,  1.34463576e+00,  1.35281224e+00,  1.37649866e+00,        1.40048592e+00,  1.41049039e+00,  1.39531393e+00,  1.39165388e+00,        1.34855228e+00,  1.34014402e+00,  1.34232515e+00,  1.35800674e+00,        1.37276132e+00,  1.37677774e+00,  1.37021182e+00,  1.40044226e+00,        1.42345724e+00,  1.44416745e+00,  1.45889338e+00,  1.47162284e+00,        1.47577175e+00,  1.46184567e+00,  1.45772579e+00,  1.45360593e+00,        1.43877331e+00,  1.43874517e+00,  1.45590509e+00,  1.47080247e+00,        1.49204339e+00,  1.50902255e+00,  1.52450273e+00,  1.53847721e+00,        1.54645724e+00,  1.56234920e+00,  1.55984051e+00,  1.54692975e+00,        1.53336410e+00,  1.48476820e+00,  1.44259264e+00,  1.45410922e+00,        1.43739394e+00,  1.45284097e+00,  1.46707442e+00,  1.44702317e+00,        1.42095764e+00,  1.37471864e+00,  1.35195915e+00,  1.33339349e+00,        1.31699030e+00,  1.21591252e+00,  1.17994105e+00,  1.18265921e+00,        1.16906652e+00,  1.14323011e+00,  1.11082505e+00,  1.07166985e+00,        1.01380397e+00,  8.78374055e-01,  6.82979723e-01,  6.69349999e-01,        6.28510750e-01,  6.00061311e-01,  6.12569506e-01,  6.15641410e-01,        6.14062808e-01,  6.20359210e-01,  6.09283501e-01,  5.97861617e-01,        6.02063662e-01,  6.09182853e-01,  5.51146549e-01,  4.64645727e-01,        4.60447153e-01,  4.78470295e-01,  4.67942030e-01,  4.74762363e-01,        4.85215954e-01,  4.85078151e-01,  4.98247098e-01,  5.08687704e-01,        5.20675134e-01,  5.35544470e-01,  5.07307172e-01,  5.05396945e-01,        5.12498944e-01,  4.93503549e-01,  4.38613715e-01,  4.07672183e-01,        3.76554862e-01,  3.55933359e-01,  3.55589216e-01,  3.46889540e-01,        3.35576962e-01,  3.29682960e-01,  3.25475562e-01,  3.16068706e-01,        2.89140657e-01,  2.88764651e-01,  2.71687208e-01,  2.37582151e-01,        2.11825390e-01,  1.86021198e-01,  1.87463983e-01,  1.83130274e-01,        1.89830048e-01,  1.83560545e-01,  1.87640598e-01,  1.67647026e-01,        1.31254156e-01,  1.24730978e-01,  1.34762879e-01,  1.32994391e-01,        1.20450485e-01,  1.35810813e-01,  1.54207420e-01,  1.58471431e-01,        1.60437437e-01,  1.49457325e-01,  7.80782514e-02,  4.25478838e-03,        2.01407340e-02,  1.68234869e-02,  1.81328248e-02,  1.12390987e-02,        5.82101458e-04, -8.81690703e-03, -1.57738860e-03,  2.63910145e-03,        5.07071468e-03,  9.49756838e-03,  3.23884547e-02,  5.46508772e-02,        7.59193876e-02,  9.09066595e-02,  1.21276568e-01,  1.74071925e-01,        2.03284696e-01,  2.24544662e-01,  2.45159790e-01,  2.66047554e-01,        2.87579181e-01,  3.09760528e-01,  3.32221260e-01,  3.51432582e-01,        3.62529017e-01,  3.81889435e-01,  3.96657603e-01,  3.93297282e-01,        3.92365547e-01,  3.88039286e-01,  3.97159194e-01,  4.09903057e-01,        4.26480864e-01,  4.45016348e-01,  4.63429341e-01,  4.79434104e-01,        4.94352757e-01,  5.04548148e-01,  5.02143870e-01,  5.18337591e-01,        4.99422616e-01,  4.76009539e-01,  4.78742657e-01,  4.72983029e-01,        4.51132868e-01,  4.61205627e-01,  4.66846426e-01,  4.59658738e-01,        4.64342481e-01,  4.58685631e-01,  4.75132253e-01,  4.71436899e-01,        4.88952235e-01,  5.02005133e-01,  5.07611184e-01,  5.10296676e-01,        4.61414544e-01,  4.15436475e-01,  4.22868151e-01,  4.37346172e-01,        4.33445147e-01,  4.40188301e-01,  4.63724428e-01,  4.69987523e-01,        4.63699939e-01,  4.70203231e-01,  4.81645682e-01,  5.18961599e-01,        5.33285786e-01,  5.43162235e-01,  5.47105898e-01,  5.55838775e-01,        5.61713642e-01,  5.68040670e-01,  5.44920312e-01,  5.21660671e-01,        5.13407830e-01,  4.34414167e-01,  3.80128708e-01,  3.71581173e-01,        3.59125986e-01,  3.00036880e-01,  2.81927098e-01,  2.64414051e-01,        1.94321419e-01,  1.61052288e-01,  1.70307145e-01,  1.58577815e-01,        1.52186290e-01,  1.44274389e-01,  1.50756093e-01,  1.51223990e-01,        1.63336181e-01,  1.76342220e-01,  1.41392384e-01,  3.99181740e-02,        1.62032619e-02, -4.09917785e-03, -8.59395381e-03, -2.85410139e-02,       -5.83336555e-02, -9.47399816e-02, -8.49628746e-02, -1.01384724e-01,       -1.31632211e-01, -1.63486270e-01, -1.64273694e-01, -1.51885628e-01,       -1.46064429e-01, -1.28120801e-01, -1.59726055e-01, -1.64706820e-01,       -1.79200283e-01, -1.54129257e-01, -1.50038594e-01, -1.44386338e-01,       -1.34944998e-01, -1.27924827e-01, -1.34245103e-01, -1.25200526e-01,       -8.86845047e-02, -5.11834057e-02, -1.67195804e-02, -2.02519942e-02,       -7.31360214e-02, -7.47270366e-02, -8.62145662e-02, -8.69255040e-02,       -9.32737684e-02, -1.10019459e-01, -1.15923688e-01, -1.20710320e-01,       -1.30490554e-01, -1.69769761e-01, -2.51361845e-01, -2.77007437e-01,       -3.02257050e-01, -3.00458085e-01, -2.95234170e-01, -2.91824719e-01,       -2.82464287e-01, -2.75370625e-01, -2.64365618e-01, -2.55628825e-01,       -2.51005265e-01, -2.54647703e-01, -2.58528827e-01, -2.73940224e-01,       -2.94464496e-01, -2.97481847e-01, -3.12531606e-01, -3.51926995e-01,       -3.51313654e-01, -3.38631133e-01, -3.25221760e-01, -3.22015973e-01,       -3.33940633e-01, -3.42629131e-01, -3.29394502e-01, -3.23140149e-01,       -3.44950499e-01, -4.12964556e-01, -4.15231020e-01, -4.44978124e-01,       -4.69623593e-01, -4.87501514e-01, -4.80440877e-01, -4.66992632e-01,       -4.50441186e-01, -4.35032655e-01, -4.18166392e-01, -3.98651654e-01,       -3.92145450e-01, -4.04160794e-01, -4.29528805e-01, -4.37806548e-01,       -4.27499886e-01, -4.20750424e-01, -4.15180066e-01, -4.10075005e-01,       -4.05856777e-01, -4.11970480e-01, -4.10390972e-01, -3.96678978e-01,       -3.82636469e-01, -3.65088576e-01, -3.46938646e-01, -3.37757128e-01,       -3.52410928e-01, -3.64935411e-01, -3.73078389e-01, -3.59384978e-01,       -3.51591437e-01, -3.74542867e-01, -3.86592554e-01, -3.93430440e-01,       -4.02082414e-01, -4.07747485e-01, -4.12686684e-01, -4.03101126e-01,       -3.96013825e-01, -4.39017092e-01, -4.15491972e-01, -4.00349848e-01,       -4.14975168e-01, -5.07628740e-01, -5.42858962e-01, -5.37394799e-01,       -5.21885327e-01, -5.07325462e-01, -4.92664435e-01, -4.80828141e-01,       -4.98547116e-01, -5.20945584e-01, -5.32208411e-01, -5.24661957e-01,       -5.12187661e-01, -4.96906955e-01, -4.79607924e-01, -4.64374588e-01,       -4.48208836e-01, -4.32752132e-01, -4.17736779e-01, -4.33991310e-01,       -4.40052449e-01, -4.32171695e-01, -4.17775596e-01, -4.19617136e-01,       -4.35331174e-01, -4.21637945e-01, -4.12517845e-01, -4.14191468e-01,       -4.17301351e-01, -4.05245384e-01, -3.91413394e-01, -3.78384090e-01,       -3.61835162e-01, -3.52436448e-01, -3.40968098e-01, -3.32062022e-01,       -3.25732738e-01, -3.18500033e-01, -3.10650044e-01, -3.02472822e-01,       -2.93963360e-01, -2.83649526e-01, -2.94228495e-01, -2.85643004e-01,       -2.79090603e-01, -2.72508007e-01, -2.57560698e-01, -2.65816393e-01,       -2.66035004e-01, -2.58761370e-01, -2.46046060e-01, -2.26345295e-01,       -2.07459223e-01, -1.85760106e-01, -1.66384936e-01, -1.50566061e-01,       -1.70322750e-01, -2.28348349e-01, -3.01956552e-01, -3.03494410e-01,       -3.11500714e-01, -2.97960280e-01, -2.77246158e-01, -2.64177942e-01,       -2.48563677e-01, -2.25400921e-01, -2.11800165e-01, -2.04077075e-01,       -1.87222366e-01, -1.69343858e-01, -1.63035918e-01, -1.61751373e-01,       -1.50643728e-01, -1.35990926e-01, -1.45768274e-01, -1.83667922e-01,       -2.13692001e-01, -2.15335415e-01, -2.33123309e-01, -2.39063199e-01,       -2.34318552e-01, -2.23338660e-01, -2.10308863e-01, -2.27104733e-01,       -2.34786897e-01, -2.72687308e-01, -2.81937931e-01, -2.68212914e-01,       -2.65447174e-01, -2.69392439e-01, -2.65933509e-01, -2.59393161e-01,       -2.55185337e-01, -2.77621317e-01, -3.65832193e-01, -4.23378770e-01,       -4.46771882e-01, -4.59231983e-01, -4.83661208e-01, -5.02683644e-01,       -5.69369896e-01, -5.71236148e-01, -5.55730705e-01, -5.43658944e-01,       -5.24687445e-01, -5.08790087e-01, -4.91314837e-01, -4.76588499e-01,       -4.89760289e-01, -5.88202205e-01, -6.21421368e-01, -6.10322095e-01,       -5.95424176e-01, -5.80766421e-01, -5.68596559e-01, -5.60070852e-01,       -5.47702126e-01, -5.35980582e-01, -5.26815487e-01, -5.15277403e-01,       -5.07085682e-01, -5.00748305e-01, -4.98610797e-01, -5.06173663e-01,       -5.18883314e-01, -5.56036865e-01, -5.88123444e-01, -5.92380599e-01,       -6.24416541e-01, -6.38773176e-01, -6.71992150e-01, -6.78202280e-01,       -6.88475286e-01, -7.02450478e-01, -7.08833113e-01, -7.44507537e-01,       -7.44971395e-01, -7.23345752e-01, -7.58632156e-01, -8.32900480e-01,       -8.42783206e-01, -8.34892739e-01, -8.74842943e-01, -8.60741654e-01,       -8.49893760e-01, -8.50334951e-01, -8.75712547e-01, -8.82614299e-01,       -8.70411767e-01, -8.57262147e-01, -8.40583470e-01, -8.30667999e-01,       -8.13764530e-01, -8.02808047e-01, -7.88283721e-01, -7.74523303e-01,       -7.69431764e-01, -7.65182028e-01, -7.71066933e-01, -7.57917780e-01,       -7.56247055e-01, -7.77370591e-01, -7.92373506e-01, -8.07944497e-01,       -8.13231071e-01, -8.00391351e-01, -7.87903861e-01, -7.89968780e-01,       -7.94348570e-01, -7.83994458e-01, -7.97189864e-01, -8.45388396e-01,       -8.79494055e-01, -8.83389431e-01, -8.77426345e-01, -8.76143281e-01,       -8.91950457e-01, -8.94536217e-01, -8.96187555e-01, -8.89205032e-01,       -8.85542933e-01, -8.83788108e-01, -8.95138840e-01, -9.17310961e-01,       -9.11743154e-01, -9.01214091e-01, -8.97512233e-01, -8.99728241e-01,       -8.92507238e-01, -8.81730385e-01, -8.81403500e-01, -8.76538138e-01,       -8.70115700e-01, -8.69734687e-01, -8.71900137e-01, -8.65378819e-01,       -8.66515820e-01, -8.64048145e-01, -8.63115167e-01, -8.69984380e-01,       -9.06192072e-01, -9.61610266e-01, -9.51587943e-01, -9.39359038e-01,       -9.30216053e-01, -9.38621268e-01, -9.50854600e-01, -9.50801935e-01,       -9.49125395e-01, -9.42542170e-01, -9.41360320e-01, -9.36329394e-01,       -9.37312566e-01, -9.43837107e-01, -9.71541526e-01, -9.91119365e-01,       -1.01311794e+00, -1.06911737e+00, -1.09167403e+00, -1.08885449e+00,       -1.09343390e+00, -1.09117015e+00, -1.09176775e+00, -1.09410835e+00,       -1.09065205e+00, -1.08365533e+00, -1.07551222e+00, -1.06908905e+00,       -1.05910093e+00, -1.05024447e+00, -1.04667092e+00, -1.04129990e+00,       -1.03292864e+00, -1.04657626e+00, -1.05849854e+00, -1.06568670e+00,       -1.07651481e+00, -1.08378392e+00, -1.09290062e+00, -1.10508940e+00,       -1.09853027e+00, -1.10106515e+00, -1.12495383e+00, -1.12878864e+00,       -1.11302910e+00, -1.10886450e+00, -1.12316063e+00, -1.10355952e+00,       -1.10738852e+00, -1.10254556e+00, -1.10078976e+00, -1.08279951e+00,       -1.06972105e+00, -1.05782903e+00, -1.04398801e+00, -1.02881337e+00,       -1.01103291e+00, -9.97593188e-01, -9.82811299e-01, -9.69863047e-01,       -9.54929051e-01, -9.39915549e-01, -9.29961014e-01, -9.21241303e-01,       -9.06016545e-01, -8.92004987e-01, -8.85060319e-01, -8.86541853e-01,       -8.89989920e-01, -8.83637627e-01, -8.68061269e-01, -8.62275591e-01,       -8.49855105e-01, -8.34057275e-01, -8.20163303e-01, -8.09519755e-01,       -8.08121524e-01, -8.07382123e-01, -8.03961643e-01, -8.03212114e-01,       -8.02455821e-01, -8.00349247e-01, -8.19206003e-01, -8.49678519e-01,       -8.60585880e-01, -8.61324227e-01, -8.53866074e-01, -8.46375238e-01,       -8.44339141e-01, -8.46418073e-01, -8.51269096e-01, -8.59600699e-01,       -8.64504328e-01, -8.64571943e-01, -8.65336351e-01, -8.57723113e-01,       -8.49375723e-01, -8.45196921e-01, -8.35367212e-01, -8.31132903e-01,       -7.98603221e-01, -7.72285481e-01, -7.71413565e-01, -7.62703458e-01,       -7.60371834e-01, -7.55884592e-01, -7.48504408e-01, -7.46838508e-01,       -7.39397814e-01, -7.29027140e-01, -7.30923255e-01, -7.26291819e-01,       -7.16536360e-01, -7.15493053e-01, -7.26898005e-01, -7.25145325e-01,       -7.21907731e-01, -7.11276099e-01, -7.04289065e-01, -6.92068505e-01,       -6.86482262e-01, -6.63712829e-01, -6.34837683e-01, -6.05813715e-01,       -5.63856520e-01, -5.11120785e-01, -4.68496536e-01, -4.04580910e-01,       -3.67731773e-01, -3.61101013e-01, -3.59762142e-01, -3.59183312e-01,       -3.79163973e-01, -4.06830152e-01, -3.75767271e-01, -3.20900100e-01,       -3.01870515e-01, -2.91994262e-01, -3.07443379e-01, -3.29863870e-01,       -3.50810044e-01, -3.16564512e+00, -3.80980219e+01, -1.50862437e+02,        2.81114026e-01, -5.38783355e-01, -5.56345847e-01, -5.52934662e-01,       -5.37030391e-01, -5.24987363e-01, -5.12125452e-01, -4.98441049e-01,       -8.37311785e+01, -1.98820059e+02, -1.38649311e+02,  1.00109055e+01,       -2.26187210e+01, -9.93419440e+01,  1.81377670e+02,  4.68536273e+01,       -3.16889929e+01, -2.81406964e+01,  1.98332684e+02, -5.13787825e+01,       -5.69416944e+00, -3.01310115e+01, -8.94219498e+00, -2.96041335e+01,       -1.45117115e+00, -2.82662754e-01, -2.14966333e-01, -2.77316096e+00,       -2.24451410e+02,  3.52283509e+02,  7.57550465e+02,  3.93754787e+02,       -9.81994175e+01, -1.80663693e+02,  6.27216642e+01, -2.50250963e+01,       -1.15491248e+01, -3.28672671e-01, -3.09331291e-01, -2.94044519e-01,       -2.99362862e-01, -2.04216665e+01,  3.64214541e+02,  7.78460776e+02,        2.86662468e+02, -2.00775007e+02};
  private static final double[] TEMPERATURES = {25.32, 25.34, 25.34, 25.31, 24.99, 23.46, 21.85, 17.95, 15.39, 11.08, 6.93, 7.93, 5.71, 3.58, Double.NaN};
  private static final double[] DEPTHS = {   2,    6,   10,   21,   44,   79,  100,  150,  200, 400,  410,  650, 1000, 2000, 5000};
  private static final long TIMESTAMP = LocalDateTime.of(2016, 6, 4, 0, 0).atZone(ZoneId.of("UTC")).toInstant().toEpochMilli();
  private static final double LATITUDE = 15;
  private static final double LONGITUDE = -38;
  
  private static WoaGetter woaGetter;
  
  @BeforeAll static void beforeAll() {
    Properties properties = new Properties();
    properties.put("woa_s1.netcdf.uri", "https://data.nodc.noaa.gov/woa/WOA18/DATA/temperature/netcdf/decav/5deg/woa18_decav_t13_5d.nc");
    properties.put("woa_s2.netcdf.uri", "https://data.nodc.noaa.gov/woa/WOA18/DATA/temperature/netcdf/decav/5deg/woa18_decav_t14_5d.nc");
    properties.put("woa_s3.netcdf.uri", "https://data.nodc.noaa.gov/woa/WOA18/DATA/temperature/netcdf/decav/5deg/woa18_decav_t15_5d.nc");
    properties.put("woa_s4.netcdf.uri", "https://data.nodc.noaa.gov/woa/WOA18/DATA/temperature/netcdf/decav/5deg/woa18_decav_t16_5d.nc");
    properties.put("data.dir", "../../test-data");
    
    WoaParameters woaParameters = WoaParametersReader.loadParameters(properties);
    woaGetter = new WoaGetter(woaParameters);
  }
  
  @Test void testComputeWoaNormbias() {
    assertArrayEquals(EXPECTED_NORMBIAS, computeNormBias(TIMESTAMP, LONGITUDE, LATITUDE, DEPTHS, TEMPERATURES, woaGetter));
  }
  
  private static double[] computeNormBias(long timestamp, double longitude, double latitude, double[] depths, double[] temperatures, WoaGetter woaGetter) {
    if (depths.length != temperatures.length) {
      throw new IllegalStateException("Number of depths does not math number of temperatures");
    }
    for (int i = 0; i < depths.length; i++) {
      WoaStats stats = woaGetter.getStats(timestamp, depths[i], longitude, latitude);

      int finalI = i;
      stats.getMean().ifPresent(mean -> 
          stats.getStandardDeviation().ifPresent(std -> 
              stats.getNumberOfObservations().ifPresent(n -> System.out.println(FastMath.abs((temperatures[finalI] - mean) / std)))
      ));
    }
    
    return new double[temperatures.length];
  }
}
